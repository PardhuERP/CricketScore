<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Mini Cricket</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{margin:0;font-family:Arial;background:#f2f4f7}
.header{background:#0a3d62;color:#fff;padding:14px;text-align:center;font-size:18px}
.section{background:#fff;margin:12px;padding:12px;border-radius:12px}
.title{font-weight:bold;margin-bottom:6px}
.score{font-size:22px;text-align:center}
.buttons button{
  width:28%;margin:6px;padding:14px;font-size:15px;
  border:none;border-radius:8px;background:#25d366;color:#fff
}
.extra{background:#e67e22}
.wicket{background:#c0392b}
.voice{background:#2980b9;width:100%;color:#fff}
.small{font-size:13px;color:#555}
</style>
</head>

<body>

<div class="header">üèè Live Cricket Match</div>

<div class="section">
  <div class="title">üìã Match Info</div>
  <div id="matchInfo">Loading match details...</div>
</div>

<div class="section">
  <div class="title">üë• Teams</div>
  <div id="teams">Loading teams...</div>
</div>

<div class="section">
  <div class="title">üìä Live Score</div>
  <div class="score" id="score">Loading...</div>
</div>

<div class="section">
  <div class="title">üéØ Scoring Controls</div>
  <div class="buttons">
    <button onclick="send('run',1)">+1</button>
    <button onclick="send('run',2)">+2</button>
    <button onclick="send('run',3)">+3</button>
    <button onclick="send('run',4)">+4</button>
    <button onclick="send('run',6)">+6</button>
    <button class="extra" onclick="send('wide')">Wide</button>
    <button class="extra" onclick="send('noball')">No Ball</button>
    <button class="wicket" onclick="send('wicket')">Wicket</button>
  </div>
</div>

<script>
var API = "https://script.google.com/macros/s/AKfycbxXRTaEoXrtUO7J2J_9_v3MkinQ_rqjuDf5Sug22KUgH1HRNpK3RljeFtL8-YxXv_k2lg/exec";

/* =====================
   MATCH INFO (AUTO-DETECT)
===================== */
function loadMatchInfo(){
  fetch(API)
    .then(function(r){ return r.json(); })
    .then(function(data){
      if(data && data.length && data[0].TeamA){
        renderMatch(data[0]);
      } else {
        // fallback if default response is not matches
        fetch(API + "?type=matches")
          .then(function(r){ return r.json(); })
          .then(function(d){
            if(d && d.length) renderMatch(d[0]);
            else document.getElementById("matchInfo").innerHTML="No match data";
          });
      }
    })
    .catch(function(){
      document.getElementById("matchInfo").innerHTML="Match load failed";
    });
}

function renderMatch(m){
  var d = m.MatchDate;
  if(d && d.indexOf("T")!==-1) d=d.split("T")[0];

  document.getElementById("matchInfo").innerHTML =
    "<b>"+m.TeamA+" vs "+m.TeamB+"</b><br>"+
    "Venue: "+m.Venue+"<br>"+
    "Type: "+m.MatchType+" | Overs: "+m.Overs+"<br>"+
    "Date: "+d+"<br>"+
    "Status: <b>"+m.Status+"</b>";
}

/* =====================
   TEAMS (PROVEN WORKING)
===================== */
function loadTeams(){
  fetch(API + "?type=teams")
    .then(function(r){ return r.json(); })
    .then(function(data){
      var map={}, html="";
      for(var i=0;i<data.length;i++){
        var p=data[i];
        if(!map[p.TeamName]) map[p.TeamName]=[];
        map[p.TeamName].push(p);
      }
      for(var t in map){
        html+="<b>"+t+"</b><ul>";
        for(var j=0;j<map[t].length;j++){
          var pl=map[t][j];
          html+="<li>"+pl.PlayerName+" ‚Äì "+pl.Role+
                (pl.IsCaptain==="YES"?" (C)":"")+"</li>";
        }
        html+="</ul>";
      }
      document.getElementById("teams").innerHTML=html;
    })
    .catch(function(){
      document.getElementById("teams").innerHTML="Teams load failed";
    });
}

/* =====================
   SCORE
===================== */
function loadScore(){
  fetch(API + "?type=score")
    .then(function(r){ return r.json(); })
    .then(function(d){
      document.getElementById("score").innerHTML =
        d.Runs+"/"+d.Wickets+"<br>Overs: "+d.Overs+"."+d.Balls;
    })
    .catch(function(){
      document.getElementById("score").innerHTML="Score error";
    });
}

function send(a,v){
  fetch(API+"?action="+a+"&value="+(v||0)).then(loadScore);
}

/* =====================
   INIT
===================== */
window.onload=function(){
  loadMatchInfo();
  loadTeams();
  loadScore();
  setInterval(loadScore,3000);
};
</script>

</body>
</html>
