<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Mini Cricket</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{margin:0;font-family:Arial;background:#f2f4f7}
.header{background:#0a3d62;color:#fff;padding:14px;text-align:center;font-size:18px}
.section{background:#fff;margin:12px;padding:12px;border-radius:12px}
.title{font-weight:bold;margin-bottom:6px}
.score{font-size:22px;text-align:center}
.buttons button{
  width:28%;margin:6px;padding:14px;font-size:15px;
  border:none;border-radius:8px;background:#25d366;color:#fff
}
.extra{background:#e67e22}
.wicket{background:#c0392b}
.voice{background:#2980b9;width:100%;color:#fff}
.small{font-size:13px;color:#555}
</style>
</head>

<body>

<div class="header">ğŸ Live Cricket Match</div>

<!-- MATCH INFO -->
<div class="section">
  <div class="title">ğŸ“‹ Match Info</div>
  <div id="matchInfo">Loading match details...</div>
</div>

<!-- TEAMS -->
<div class="section">
  <div class="title">ğŸ‘¥ Teams</div>
  <div id="teams">Loading teams...</div>
</div>

<!-- LIVE SCORE -->
<div class="section">
  <div class="title">ğŸ“Š Live Score</div>
  <div class="score" id="score">Loading...</div>
</div>

<!-- SCORING CONTROLS -->
<div class="section">
  <div class="title">ğŸ¯ Scoring Controls</div>
  <div class="buttons">
    <button onclick="send('run',1)">+1</button>
    <button onclick="send('run',2)">+2</button>
    <button onclick="send('run',3)">+3</button>
    <button onclick="send('run',4)">+4</button>
    <button onclick="send('run',6)">+6</button>
    <button class="extra" onclick="send('wide')">Wide</button>
    <button class="extra" onclick="send('noball')">No Ball</button>
    <button class="wicket" onclick="send('wicket')">Wicket</button>
  </div>
</div>

<!-- VOICE -->
<div class="section">
  <div class="title">ğŸ™ï¸ Voice Scoring</div>
  <button class="voice" onclick="startVoice()">Start Voice</button>
  <div id="voiceText" class="small"></div>
</div>

<!-- SCORECARD -->
<div class="section">
  <div class="title">ğŸ§¾ Scorecard</div>
  <div id="scorecard">Scorecard coming next...</div>
</div>

<script>
const API =
"https://script.google.com/macros/s/AKfycbxXRTaEoXrtUO7J2J_9_v3MkinQ_rqjuDf5Sug22KUgH1HRNpK3RljeFtL8-YxXv_k2lg/exec";

/* =====================
   MATCH INFO (FINAL FIX)
===================== */
function loadMatchInfo(){
  fetch(API)
    .then(r => r.json())
    .then(data => {
      if(!data || data.length === 0){
        document.getElementById("matchInfo").innerText = "No match data";
        return;
      }

      const m = data[0];

      // ğŸ”§ DATE FIX (ONLY CHANGE)
      let matchDate = m.MatchDate;
      if (matchDate && matchDate.includes("T")) {
        matchDate = matchDate.split("T")[0];
      }

      document.getElementById("matchInfo").innerHTML = `
        <b>${m.TeamA} vs ${m.TeamB}</b><br>
        Match ID: ${m.MatchID}<br>
        Venue: ${m.Venue}<br>
        Type: ${m.MatchType} | Overs: ${m.Overs}<br>
        Date: ${matchDate}<br>
        Status: <b>${m.Status}</b>
      `;
    })
    .catch(()=>{
      document.getElementById("matchInfo").innerText="Error loading match info";
    });
}

/* =====================
   TEAMS (FINAL)
===================== */
function loadTeams(){
  fetch(API + "?type=teams")
    .then(r => r.json())
    .then(data => {
      if(!data || data.length === 0){
        document.getElementById("teams").innerText = "No Playing XI data";
        return;
      }

      const map = {};
      data.forEach(p => {
        if(!map[p.TeamName]) map[p.TeamName] = [];
        map[p.TeamName].push(p);
      });

      let html = "";
      Object.keys(map).forEach(team => {
        html += `<b>${team}</b><ul>`;
        map[team].forEach(p => {
          const cap = (p.IsCaptain === "YES") ? " (C)" : "";
          html += `<li>${p.PlayerName} â€“ ${p.Role}${cap}</li>`;
        });
        html += `</ul>`;
      });

      document.getElementById("teams").innerHTML = html;
    })
    .catch(()=>{
      document.getElementById("teams").innerText="Error loading teams";
    });
}

/* =====================
   LIVE SCORE
===================== */
function loadScore(){
  fetch(API + "?type=score")
    .then(r=>r.json())
    .then(d=>{
      document.getElementById("score").innerHTML =
        d.Runs + "/" + d.Wickets + "<br>Overs: " + d.Overs + "." + d.Balls;
    });
}

function send(action,value=0){
  fetch(API + "?action=" + action + "&value=" + value)
    .then(()=>loadScore());
}

/* =====================
   VOICE
===================== */
function startVoice(){
  if(!('webkitSpeechRecognition' in window)){
    alert("Voice not supported"); return;
  }
  const r = new webkitSpeechRecognition();
  r.lang = "en-IN";
  r.onresult = e=>{
    const t = e.results[0][0].transcript.toLowerCase();
    document.getElementById("voiceText").innerText = "ğŸ§ " + t;

    if(t.includes("one")||t.includes("single")) send("run",1);
    else if(t.includes("two")||t.includes("double")) send("run",2);
    else if(t.includes("three")) send("run",3);
    else if(t.includes("four")) send("run",4);
    else if(t.includes("six")) send("run",6);
    else if(t.includes("wide")) send("wide");
    else if(t.includes("no ball")) send("noball");
    else if(t.includes("wicket")||t.includes("out")) send("wicket");
  };
  r.start();
}

/* =====================
   AUTO LOAD
===================== */
loadMatchInfo();
loadTeams();
loadScore();
setInterval(loadScore,3000);
</script>

</body>
</html>
