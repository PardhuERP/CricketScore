<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Match Setup</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{font-family:Arial;background:#f2f4f8;margin:0}
.header{background:#0a7cff;color:#fff;padding:14px;text-align:center}
.card{background:#fff;margin:12px;padding:14px;border-radius:12px}
button{padding:12px;width:100%;border:none;border-radius:10px;background:#0a7cff;color:#fff;font-size:16px}
input,select{width:100%;padding:10px;margin-top:8px}
.back{position:absolute;left:10px;cursor:pointer}
</style>

<script>
const API_URL =
"https://script.google.com/macros/s/AKfycbzdz3UnRjf-nDbzd9WCdKpQG32jXc1ehGKeXy9q_Czm8ASwHSszmvWlNQa8OSL-6VE/exec";
</script>
</head>

<body>

<div class="header">
  <span class="back" onclick="location.href='dashboard.html'">‚¨Ö</span>
  üõ†Ô∏è Match Setup
</div>

<div class="card">

  <!-- üÜï MATCH TITLE (AUTO OPTIONAL) -->
  <input id="match" placeholder="Match Title (auto optional)">

  <!-- üÜï TEAM DROPDOWNS -->
  <select id="batting">
    <option value="">Select Batting Team</option>
  </select>

  <select id="bowling">
    <option value="">Select Bowling Team</option>
  </select>

  <input id="overs" type="number" placeholder="Overs (eg 20)">

  <button onclick="startMatch()">Start Match</button>
</div>

<script>
/* ================= LOAD TEAMS ================= */
function loadTeams(){
  const cb="cbTeams_"+Date.now();
  window[cb]=res=>{
    const bat=document.getElementById("batting");
    const bowl=document.getElementById("bowling");

    res.forEach(t=>{
      bat.innerHTML+=`<option value="${t}">${t}</option>`;
      bowl.innerHTML+=`<option value="${t}">${t}</option>`;
    });
    delete window[cb];
  };

  const s=document.createElement("script");
  s.src=API_URL+"?action=getTeams&callback="+cb;
  document.body.appendChild(s);
}

/* ================= START MATCH ================= */
function startMatch(){
  let match = document.getElementById("match").value;
  const batting = document.getElementById("batting").value;
  const bowling = document.getElementById("bowling").value;
  const overs = document.getElementById("overs").value;

  if(!batting || !bowling || !overs){
    alert("Please select teams and overs");
    return;
  }

  if(batting === bowling){
    alert("Batting and Bowling teams cannot be same");
    return;
  }

  /* üß† AUTO MATCH TITLE */
  if(!match){
    match = batting + " vs " + bowling;
  }

  const cb="cb_"+Date.now();
  window[cb]=res=>{
    if(res.status==="ok"){
      alert("Match started");
      location.href="score-entry.html";
    }else{
      alert(res.msg||"Error");
    }
    delete window[cb];
  };

  const s=document.createElement("script");
  s.src = API_URL +
    "?action=startMatch" +
    "&match="+encodeURIComponent(match) +
    "&batting="+encodeURIComponent(batting) +
    "&bowling="+encodeURIComponent(bowling) +
    "&overs="+overs +
    "&callback="+cb;

  document.body.appendChild(s);
}

/* INIT */
window.onload = loadTeams;
</script>

</body>
</html>
