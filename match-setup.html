<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Match Setup</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{margin:0;font-family:Arial;background:#f2f4f8}
.header{background:#0a7cff;color:#fff;padding:14px;text-align:center;font-size:18px}
.card{background:#fff;margin:15px;padding:15px;border-radius:12px}
select,input,button{
  width:100%;padding:12px;margin-top:10px;
  border-radius:8px;border:1px solid #ccc;font-size:15px
}
button{background:#0a7cff;color:#fff;border:none}
</style>
</head>

<body>

<div class="header">üõ†Ô∏è Match Setup</div>

<div class="card">
  <label>Match Title</label>
  <input id="matchTitle" placeholder="Team A vs Team B">

  <label>Overs Limit</label>
  <select id="overs">
    <option value="1">1</option>
    <option value="2">2</option>
    <option value="5">5</option>
    <option value="10">10</option>
    <option value="15">15</option>
    <option value="20" selected>20</option>
  </select>
</div>

<div class="card">
  <label>Batting Team</label>
  <select id="batting"></select>

  <label>Bowling Team</label>
  <select id="bowling"></select>
</div>

<div class="card">
  <label>Striker</label>
  <select id="striker"></select>

  <label>Non-Striker</label>
  <select id="nonstriker"></select>

  <label>Bowler</label>
  <select id="bowler"></select>
</div>

<div class="card">
  <button onclick="startMatch()">‚ñ∂ Start Match</button>
</div>

<script>
const API =
"https://script.google.com/macros/s/AKfycbzdz3UnRjf-nDbzd9WCdKpQG32jXc1ehGKeXy9q_Czm8ASwHSszmvWlNQa8OSL-6VE/exec";

/* ---------------- JSONP ---------------- */
function jsonp(url, cbName){
  const s = document.createElement("script");
  s.src = url + "&callback=" + cbName;
  document.body.appendChild(s);
}

/* ---------------- LOAD TEAMS ---------------- */
jsonp(API + "?action=getTeams", "loadTeams");

function loadTeams(teams){
  ["batting","bowling"].forEach(id=>{
    const sel = document.getElementById(id);
    sel.innerHTML = "<option value=''>Select</option>";
    teams.forEach(t=>{
      const o=document.createElement("option");
      o.value=o.textContent=t;
      sel.appendChild(o);
    });
  });
}

/* ---------------- LOAD PLAYERS ---------------- */
batting.onchange = ()=>{
  const team = batting.value;
  striker.innerHTML = "<option value=''>Select</option>";
  nonstriker.innerHTML = "<option value=''>Select</option>";
  if(!team) return;
  jsonp(API + "?action=getPlayers&team=" + encodeURIComponent(team), "loadBatters");
};

bowling.onchange = ()=>{
  const team = bowling.value;
  bowler.innerHTML = "<option value=''>Select</option>";
  if(!team) return;
  jsonp(API + "?action=getPlayers&team=" + encodeURIComponent(team), "loadBowlers");
};

function loadBatters(players){
  [striker, nonstriker].forEach(sel=>{
    sel.innerHTML = "<option value=''>Select</option>";
    players.forEach(p=>{
      const o=document.createElement("option");
      o.value=o.textContent=p.name;
      sel.appendChild(o);
    });
  });
}

function loadBowlers(players){
  bowler.innerHTML = "<option value=''>Select</option>";
  players.forEach(p=>{
    const o=document.createElement("option");
    o.value=o.textContent=p.name;
    bowler.appendChild(o);
  });
}

/* ---------------- START MATCH ---------------- */
function startMatch(){

  if(
    !matchTitle.value ||
    !batting.value ||
    !bowling.value ||
    !overs.value ||
    !striker.value ||
    !nonstriker.value ||
    !bowler.value
  ){
    alert("Please select all match details");
    return;
  }

  if(batting.value === bowling.value){
    alert("Batting and Bowling teams cannot be same");
    return;
  }

  if(striker.value === nonstriker.value){
    alert("Striker and Non-Striker must be different");
    return;
  }

  const q =
    "?action=startMatch"+
    "&match="+encodeURIComponent(matchTitle.value)+
    "&batting="+encodeURIComponent(batting.value)+
    "&bowling="+encodeURIComponent(bowling.value)+
    "&overs="+encodeURIComponent(overs.value)+
    "&striker="+encodeURIComponent(striker.value)+
    "&nonstriker="+encodeURIComponent(nonstriker.value)+
    "&bowler="+encodeURIComponent(bowler.value);

  jsonp(API + q, "matchStarted");
}

function matchStarted(res){
  if(res.status === "ok"){
    location.href = "score-entry.html";
  }else{
    alert(res.msg || "Failed to start match");
  }
}
</script>

</body>
</html>
