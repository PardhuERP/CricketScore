<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Match Setup</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{margin:0;font-family:Arial;background:#f2f4f8}
.header{background:#0a7cff;color:#fff;padding:14px;text-align:center;font-size:18px}
.card{background:#fff;margin:15px;padding:15px;border-radius:12px}
select,input,button{
  width:100%;padding:12px;margin-top:10px;
  border-radius:8px;border:1px solid #ccc;font-size:15px
}
button{background:#0a7cff;color:#fff;border:none}
</style>
</head>

<body>

<div class="header">üõ†Ô∏è Match Setup</div>

<div class="card">
  <label>Match Title</label>
  <input id="matchTitle" placeholder="Team A vs Team B">

  <label>Overs Limit</label>
  <select id="overs">
    <option>1</option>
    <option>2</option>
    <option>5</option>
    <option>10</option>
    <option>15</option>
    <option selected>20</option>
  </select>
</div>

<div class="card">
  <label>Batting Team</label>
  <select id="batting"></select>

  <label>Bowling Team</label>
  <select id="bowling"></select>
</div>

<div class="card">
  <label>Striker</label>
  <select id="striker"></select>

  <label>Non-Striker</label>
  <select id="nonstriker"></select>

  <label>Bowler</label>
  <select id="bowler"></select>
</div>

<div class="card">
  <button onclick="startMatch()">‚ñ∂ Start Match</button>
</div>

<script>
const API =
"https://script.google.com/macros/s/AKfycbzdz3UnRjf-nDbzd9WCdKpQG32jXc1ehGKeXy9q_Czm8ASwHSszmvWlNQa8OSL-6VE/exec";

function jsonp(url,cb){
  const s=document.createElement("script");
  s.src=url+"&callback="+cb;
  document.body.appendChild(s);
}

/* Load Teams */
jsonp(API+"?action=getTeams","loadTeams");
function loadTeams(t){
  ["batting","bowling"].forEach(id=>{
    const s=document.getElementById(id);
    s.innerHTML="<option value=''>Select</option>";
    t.forEach(x=>s.innerHTML+=`<option value="${x}">${x}</option>`);
  });
}

/* Load Players on Team Change */
document.getElementById("batting").onchange=()=>{
  const team=batting.value;
  striker.innerHTML=nonstriker.innerHTML="<option value=''>Select</option>";
  if(team){
    jsonp(API+"?action=getPlayers&team="+encodeURIComponent(team),"battingPlayers");
  }
};

document.getElementById("bowling").onchange=()=>{
  const team=bowling.value;
  bowler.innerHTML="<option value=''>Select</option>";
  if(team){
    jsonp(API+"?action=getPlayers&team="+encodeURIComponent(team),"bowlingPlayers");
  }
};

function battingPlayers(p){
  fill(["striker","nonstriker"],p);
}
function bowlingPlayers(p){
  fill(["bowler"],p);
}

function fill(ids,p){
  ids.forEach(id=>{
    const s=document.getElementById(id);
    s.innerHTML="<option value=''>Select</option>";
    p.forEach(x=>s.innerHTML+=`<option value="${x.name}">${x.name}</option>`);
  });
}

/* START MATCH ‚Äì FINAL FIX */
function startMatch(){

  if(!matchTitle.value || !batting.value || !bowling.value || !overs.value){
    alert("‚ö† Please fill all match details");
    return;
  }

  if(batting.value===bowling.value){
    alert("‚ö† Batting and Bowling teams must be different");
    return;
  }

  if(!striker.value || !nonstriker.value || !bowler.value){
    alert("‚ö† Please select Striker, Non-Striker and Bowler");
    return;
  }

  const q =
    "?action=startMatch"+
    "&match="+encodeURIComponent(matchTitle.value)+
    "&batting="+encodeURIComponent(batting.value)+
    "&bowling="+encodeURIComponent(bowling.value)+
    "&overs="+encodeURIComponent(overs.value)+
    "&striker="+encodeURIComponent(striker.value)+
    "&nonstriker="+encodeURIComponent(nonstriker.value)+
    "&bowler="+encodeURIComponent(bowler.value);

  jsonp(API+q,"done");
}

function done(res){
  if(res.status==="ok"){
    location.href="score-entry.html";
  }else{
    alert(res.msg || "Match not started");
  }
}
</script>

</body>
</html>
