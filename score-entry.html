<!DOCTYPE html>  <html lang="en">  
<head>  
<meta charset="UTF-8">  
<title>Score Entry</title>  
<meta name="viewport" content="width=device-width, initial-scale=1">  <style>  
body{margin:0;font-family:Arial;background:#f2f4f8}  
.header{background:#0a7cff;color:#fff;padding:14px;text-align:center;font-size:18px;font-weight:bold}  
.container{padding:14px}  
.card{background:#fff;border-radius:14px;padding:14px;margin-bottom:14px;box-shadow:0 4px 10px rgba(0,0,0,0.08);text-align:center}  
.score{font-size:28px;font-weight:bold}  
.sub{color:#555;margin-top:4px}  
.small{font-size:14px;margin-top:4px;color:#333}  
.grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:10px}  
button{padding:14px;font-size:18px;border:none;border-radius:10px;cursor:pointer;background:#0a7cff;color:#fff}  
.extra{background:#ff9800}  
.wicket{background:#e53935}  
select{width:100%;padding:10px;margin-top:8px}  
</style>  <script>  
const API_URL="https://script.google.com/macros/s/AKfycbzdz3UnRjf-nDbzd9WCdKpQG32jXc1ehGKeXy9q_Czm8ASwHSszmvWlNQa8OSL-6VE/exec";  
  
let striker="", nonStriker="", bowler="";  
let batsmen={}, bowlers={};  
let inningsStatus="LIVE";  
  
/* ---------- JSONP ---------- */  
function callAPI(p,cb){  
  const f="cb_"+Date.now();  
  window[f]=r=>{cb&&cb(r);delete window[f];s.remove()};  
  const q=Object.keys(p).map(k=>k+"="+encodeURIComponent(p[k])).join("&");  
  const s=document.createElement("script");  
  s.src=API_URL+"?"+q+"&callback="+f;  
  document.body.appendChild(s);  
}  
  
/* ---------- UI CONTROL ---------- */  
function disableScore(dis){  
  document.querySelectorAll(".score-btn").forEach(b=>{  
    b.disabled=dis;  
    b.style.opacity=dis?"0.4":"1";  
  });  
}  
  
/* ---------- UI UPDATE ---------- */  
function updateUI(r){  
  if(!r) return;  
  
  inningsStatus = r.inningsStatus;  
  const balls = parseInt(r.balls) || 0;  
  const oversLimit = (parseInt(r.oversLimit)||0)*6;  
  
  score.innerText = `${r.runs} / ${r.wickets}`;  
  overs.innerText = "Overs: " + r.overs;  
  
  batsmen = r.batsmen || batsmen;  
  bowlers = r.bowlers || bowlers;  
  
  striker = r.striker;  
  nonStriker = r.nonstriker;  
  bowler = r.bowler;  
  
  strikerBox.innerText = striker ? `üèè ${striker} : ${batsmen[striker]?.runs||0} (${batsmen[striker]?.balls||0})` : "";  
  nonBox.innerText = nonStriker ? `üèè ${nonStriker} : ${batsmen[nonStriker]?.runs||0} (${batsmen[nonStriker]?.balls||0})` : "";  
  bowlerBox.innerText = bowler ? `üéØ ${bowler} : ${bowlers[bowler]?.balls||0} balls` : "";  
  
  /* ===== LOGIC CORE - FIXED ===== */  
  
  changeBowlerBtn.style.display="none";  
  secondInningsBtn.style.display="none";  
  
  if(inningsStatus==="LIVE"){  
    disableScore(false);  
  }  
  
  if(inningsStatus==="OVER_END"){  
    disableScore(true);  
    // ‡∞á‡∞ï‡±ç‡∞ï‡∞° balls < oversLimit ‡∞∏‡∞∞‡∞ø‡∞ó‡±ç‡∞ó‡∞æ ‡∞ö‡±Ü‡∞ï‡±ç ‡∞ö‡±á‡∞∏‡±ç‡∞§‡±Å‡∞®‡±ç‡∞®‡∞æ‡∞Ç
    if(balls < oversLimit){  
      changeBowlerBtn.style.display="block";  
      changeBowlerBtn.style.margin="10px auto"; // UI alignment ‡∞ï‡±ã‡∞∏‡∞Ç
    } else {
        // ‡∞í‡∞ï‡∞µ‡±á‡∞≥ ‡∞ì‡∞µ‡∞∞‡±ç‡∞∏‡±ç ‡∞Ö‡∞Ø‡∞ø‡∞™‡±ã‡∞§‡±á ‡∞Ü‡∞ü‡±ã‡∞Æ‡±á‡∞ü‡∞ø‡∞ï‡±ç ‡∞ó‡∞æ INNINGS_END ‡∞ï‡∞ø ‡∞µ‡±Ü‡∞≥‡±ç‡∞≤‡∞æ‡∞≤‡∞ø
        secondInningsBtn.style.display="block";
    }
  }  
  
  if(inningsStatus==="INNINGS_END"){  
    disableScore(true);  
    secondInningsBtn.style.display="block";  
  }  
  
  if(inningsStatus==="SETUP"){  
    disableScore(true);  
  }  
  
  if(inningsStatus==="COMPLETED"){  
    disableScore(true);  
    alert("üèÜ Match Completed");  
    location.href="dashboard.html";  
  }  
}  
  
/* ---------- SCORE ---------- */  
function send(type,value=0){  
  if(inningsStatus!=="LIVE") return;  
  
  callAPI(  
    {action:"updateScore",type:type,value:value},  
    ()=>callAPI({action:"getLiveScore"},updateUI)  
  );  
}  
  
/* ---------- CHANGE BOWLER ---------- */  
function openBowlerChange(){  
  setupCard.style.display="block";  
  b2.innerHTML="<option value=''>Loading Players...</option>";  
  
  callAPI({action:"getLiveScore"},r=>{  
    callAPI({action:"getPlayers",team:r.bowling},players=>{  
      b2.innerHTML="<option value=''>Select Bowler</option>";  
      players.forEach(p=>{  
        const o=document.createElement("option");  
        o.value=p.name;  
        o.textContent=p.name;  
        b2.appendChild(o);  
      });  
    });  
  });  
}  
  
function confirmBowler(){  
  if(!b2.value) return alert("Select bowler");  
  
  callAPI(  
    {action:"setSecondInningsPlayers",bowler:b2.value},  
    ()=>callAPI({action:"getLiveScore"},updateUI)  
  );  
  
  setupCard.style.display="none";  
}  
  
/* ---------- 2ND INNINGS ---------- */  
function startSecondInnings(){  
  callAPI({action:"startSecondInnings"},()=>location.reload());  
}  
  
/* ---------- INIT ---------- */  
window.onload=()=>{  
  callAPI({action:"getLiveScore"},updateUI);  
};  
</script>  </head>  <body>  <div class="header">Score Entry</div>  <div class="container">  <div class="card">  
  <div class="score" id="score">0 / 0</div>  
  <div class="sub" id="overs">Overs: 0.0</div>    <div class="small" id="strikerBox"></div>  
  <div class="small" id="nonBox"></div>  
  <div class="small" id="bowlerBox"></div>  
  <button id="changeBowlerBtn" style="display:none;background:#ff9800;width:100%" onclick="openBowlerChange()">üîÑ Change Bowler</button>
  <button id="secondInningsBtn" style="display:none;background:#4caf50;width:100%" onclick="startSecondInnings()">‚ñ∂ Start 2nd Innings</button>

</div>  <div class="card" id="setupCard" style="display:none">  
  <h3>Select Bowler</h3>  
  <select id="b2"></select>  
  <button style="margin-top:10px;background:#4caf50;width:100%" onclick="confirmBowler()">Confirm Bowler</button>  
</div>  <div class="card">  
  <div class="grid">  
    <button class="score-btn" onclick="send('run',0)">0</button>  
    <button class="score-btn" onclick="send('run',1)">1</button>  
    <button class="score-btn" onclick="send('run',2)">2</button>  
    <button class="score-btn" onclick="send('run',3)">3</button>  
    <button class="score-btn" onclick="send('run',4)">4</button>  
    <button class="score-btn" onclick="send('run',6)">6</button>  
  </div>  
</div>  <div class="card">  
  <div class="grid">  
    <button class="extra score-btn" onclick="send('wide')">Wide</button>  
    <button class="extra score-btn" onclick="send('noball')">No Ball</button>  
    <button class="wicket score-btn" onclick="send('wicket')">Wicket</button>  
  </div>  
</div>  </div>  
</body>  
</html>
