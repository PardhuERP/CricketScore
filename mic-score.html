<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Voice Score Entry</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  margin:0;
  font-family: Arial, sans-serif;
  background:#f2f4f8;
}
.header{
  background:#0a7cff;
  color:#fff;
  padding:14px;
  text-align:center;
  font-size:18px;
  font-weight:bold;
}
.container{
  padding:16px;
  text-align:center;
}
.card{
  background:#fff;
  border-radius:14px;
  padding:20px;
  box-shadow:0 4px 10px rgba(0,0,0,0.08);
}
button{
  padding:14px 24px;
  font-size:18px;
  border:none;
  border-radius:30px;
  cursor:pointer;
  background:#e53935;
  color:#fff;
}
.status{
  margin-top:15px;
  font-size:14px;
  color:#555;
}
</style>
</head>

<body>

<div class="header">üé§ Voice Score Entry</div>

<div class="container">
  <div class="card">
    <button onclick="startListening()">üéôÔ∏è Start Speaking</button>
    <div class="status" id="status">Waiting...</div>
  </div>
</div>

<script>
/* ‚úÖ GOOGLE APPS SCRIPT URL */
const API_URL =
"https://script.google.com/macros/s/AKfycbzdz3UnRjf-nDbzd9WCdKpQG32jXc1ehGKeXy9q_Czm8ASwHSszmvWlNQa8OSL-6VE/exec";

/* üé§ Speech Recognition */
const SpeechRecognition =
  window.SpeechRecognition || window.webkitSpeechRecognition;

if(!SpeechRecognition){
  document.getElementById("status").innerText =
    "‚ùå Voice not supported in this browser";
}

const recognition = new SpeechRecognition();
recognition.lang = "en-IN";
recognition.continuous = false;
recognition.interimResults = false;

function startListening(){
  document.getElementById("status").innerText = "üéß Listening...";
  recognition.start();
}

recognition.onresult = function(event){
  const text = event.results[0][0].transcript.toLowerCase();
  document.getElementById("status").innerText = "Heard: " + text;
  processCommand(text);
};

recognition.onerror = function(){
  document.getElementById("status").innerText = "‚ùå Mic error";
};

/* üéØ VOICE COMMAND PARSER */
function processCommand(cmd){

  if(cmd.includes("wicket")) return sendAction("wicket");
  if(cmd.includes("wide"))   return sendAction("wide");
  if(cmd.includes("no"))     return sendAction("noball");

  if(cmd.includes("six"))   return sendAction("run",6);
  if(cmd.includes("four"))  return sendAction("run",4);
  if(cmd.includes("three")) return sendAction("run",3);
  if(cmd.includes("two"))   return sendAction("run",2);
  if(cmd.includes("one"))   return sendAction("run",1);
  if(cmd.includes("zero"))  return sendAction("run",0);

  document.getElementById("status").innerText =
    "‚ùå Command not recognized";
}

/* ‚úÖ FINAL JSONP SCORE UPDATE */
function sendAction(type,value=0){
  const cb = "cb_" + Date.now();

  window[cb] = function(res){
    console.log("Score response:", res);

    if(res.status === "ok" || res.status === "ended"){
      document.getElementById("status").innerText =
        "‚úÖ Score Updated";
    }else{
      document.getElementById("status").innerText =
        res.msg || "‚ùå Error";
    }

    delete window[cb];
  };

  const s = document.createElement("script");
  s.src =
    API_URL +
    "?action=updateScore" +
    "&type=" + encodeURIComponent(type) +
    "&value=" + encodeURIComponent(value) +
    "&callback=" + cb;

  document.body.appendChild(s);
}
</script>

</body>
</html>
