<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mic Score Entry</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:#f2f4f8;
}
.header{
  background:#0a7cff;
  color:#fff;
  padding:14px;
  text-align:center;
  font-size:18px;
  font-weight:bold;
  display:flex;
  align-items:center;
}
.back{
  margin-right:10px;
  font-size:20px;
  cursor:pointer;
}
.container{
  padding:16px;
}
.card{
  background:#fff;
  border-radius:14px;
  padding:18px;
  margin-bottom:14px;
  box-shadow:0 4px 10px rgba(0,0,0,0.08);
  text-align:center;
}
.mic-btn{
  background:#e53935;
  color:#fff;
  border:none;
  border-radius:50%;
  width:80px;
  height:80px;
  font-size:36px;
  cursor:pointer;
}
.status{
  margin-top:10px;
  font-size:14px;
  color:#555;
}
.result{
  font-size:20px;
  margin-top:10px;
  font-weight:bold;
}
</style>

<script>
const API_URL =
"https://script.google.com/macros/s/AKfycbzdz3UnRjf-nDbzd9WCdKpQG32jXc1ehGKeXy9q_Czm8ASwHSszmvWlNQa8OSL-6VE/exec";

let recognition;
let listening = false;

/* JSONP */
function callAPI(params, cb){
  const fn = "cb_" + Date.now();
  window[fn] = function(res){
    cb && cb(res);
    delete window[fn];
    s.remove();
  };
  const q = Object.keys(params).map(k=>k+"="+encodeURIComponent(params[k])).join("&");
  const s = document.createElement("script");
  s.src = API_URL + "?" + q + "&callback=" + fn + "&_=" + Date.now();
  document.body.appendChild(s);
}

/* INIT MIC */
function initMic(){
  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  if(!SpeechRecognition){
    alert("Speech recognition not supported");
    return;
  }
  recognition = new SpeechRecognition();
  recognition.lang = "en-IN";
  recognition.continuous = false;
  recognition.interimResults = false;

  recognition.onresult = function(e){
    const text = e.results[0][0].transcript.toLowerCase();
    document.getElementById("result").innerText = text;
    processVoice(text);
  };

  recognition.onend = ()=>{
    listening=false;
    document.getElementById("status").innerText="Tap mic and speak";
  };
}

/* MIC BUTTON */
function toggleMic(){
  if(!recognition) initMic();
  if(listening) return;
  listening=true;
  document.getElementById("status").innerText="Listening...";
  recognition.start();
}

/* VOICE â†’ SCORE */
function processVoice(text){
  let type="", value=0;

  if(text.includes("wide")){
    type="wide";
  }else if(text.includes("no ball")){
    type="noball";
  }else if(text.includes("wicket") || text.includes("out")){
    type="wicket";
  }else{
    const nums = {
      "zero":0,"one":1,"two":2,"three":3,"four":4,"six":6
    };
    for(let k in nums){
      if(text.includes(k)){
        type="run";
        value=nums[k];
        break;
      }
    }
  }

  if(!type){
    alert("Voice not recognized");
    return;
  }

  callAPI({
    action:"updateScore",
    type:type,
    value:value
  },()=>{
    document.getElementById("status").innerText="Score Updated âœ”";
  });
}
</script>

</head>

<body>

<div class="header">
  <div class="back" onclick="location.href='dashboard.html'">â¬…</div>
  ğŸ¤ Mic Score
</div>

<div class="container">

  <div class="card">
    <button class="mic-btn" onclick="toggleMic()">ğŸ¤</button>
    <div class="status" id="status">Tap mic and speak</div>
    <div class="result" id="result"></div>
  </div>

  <div class="card">
    <b>Say like:</b><br><br>
    â€œOne runâ€<br>
    â€œFourâ€<br>
    â€œWide ballâ€<br>
    â€œNo ballâ€<br>
    â€œWicketâ€
  </div>

</div>

</body>
</html>
