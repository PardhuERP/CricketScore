<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Match Summary</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  margin:0;
  font-family: Arial, sans-serif;
  background:#f2f4f8;
}
.header{
  background:#0a7cff;
  color:#fff;
  padding:14px;
  text-align:center;
  font-size:18px;
  font-weight:bold;
}
.container{ padding:16px; }

.card{
  background:#fff;
  border-radius:14px;
  padding:16px;
  margin-bottom:16px;
  box-shadow:0 4px 10px rgba(0,0,0,0.08);
}

.big{
  font-size:26px;
  font-weight:bold;
  text-align:center;
}
.sub{
  text-align:center;
  color:#666;
  margin-top:6px;
}

.row{
  display:flex;
  justify-content:space-between;
  margin-top:8px;
  font-size:14px;
}

table{
  width:100%;
  border-collapse:collapse;
  font-size:14px;
}
th,td{
  padding:8px;
  border-bottom:1px solid #eee;
  text-align:center;
}
th{
  background:#f7f7f7;
}
.tag{
  display:inline-block;
  padding:2px 8px;
  border-radius:6px;
  font-size:12px;
  background:#e0f2ff;
  color:#0a7cff;
}
</style>
</head>

<body>

<div class="header">üìã Match Summary</div>

<div class="container">

  <!-- MATCH SCORE -->
  <div class="card">
    <div class="big" id="score">‚Äî</div>
    <div class="sub" id="teams">‚Äî</div>
    <div class="sub" id="overs">‚Äî</div>
    <div class="sub" id="rr">‚Äî</div>
  </div>

  <!-- CURRENT PARTNERSHIP -->
  <div class="card">
    <h3>ü§ù Current Partnership</h3>
    <div id="currentPart">Loading‚Ä¶</div>
  </div>

  <!-- BATTING -->
  <div class="card">
    <h3>üèè Batting</h3>
    <table>
      <thead>
        <tr>
          <th>Player</th><th>R</th><th>B</th><th>4s</th><th>6s</th><th>SR</th>
        </tr>
      </thead>
      <tbody id="batting">Loading‚Ä¶</tbody>
    </table>
  </div>

  <!-- BOWLING -->
  <div class="card">
    <h3>üéØ Bowling</h3>
    <table>
      <thead>
        <tr>
          <th>Bowler</th><th>O</th><th>R</th><th>W</th><th>Econ</th>
        </tr>
      </thead>
      <tbody id="bowling">Loading‚Ä¶</tbody>
    </table>
  </div>

</div>

<script>
const API_URL =
"https://script.google.com/macros/s/AKfycbzdz3UnRjf-nDbzd9WCdKpQG32jXc1ehGKeXy9q_Czm8ASwHSszmvWlNQa8OSL-6VE/exec";

/* JSONP HELPER */
function jsonp(action, cb){
  const fn = "cb_" + action + "_" + Date.now();
  window[fn] = function(data){
    cb(data);
    delete window[fn];
  };
  const s = document.createElement("script");
  s.src = API_URL + "?action=" + action + "&callback=" + fn;
  document.body.appendChild(s);
}

/* LOAD SUMMARY */
function loadAll(){

  // Live Score
  jsonp("getLiveScore", d=>{
    document.getElementById("score").innerText =
      d.runs + " / " + d.wickets;
    document.getElementById("teams").innerText =
      d.batting + " vs " + d.bowling;
    document.getElementById("overs").innerText =
      "Overs: " + d.overs;

    const balls =
      Math.floor(d.overs)*6 + Math.round((d.overs%1)*10);
    const rr = balls>0 ? ((d.runs/balls)*6).toFixed(2) : "0.00";
    document.getElementById("rr").innerText =
      "Run Rate: " + rr;
  });

  // Partnership
  jsonp("getPartnership", data=>{
    const p = data.find(x=>x.status==="ACTIVE");
    document.getElementById("currentPart").innerHTML =
      p ? `${p.batsmen} ‚Äì ${p.runs} (${p.balls})` :
      "No active partnership";
  });

  // Stats
  jsonp("getStats", d=>{
    const bat = document.getElementById("batting");
    const bowl = document.getElementById("bowling");

    bat.innerHTML = "";
    d.batting.forEach(p=>{
      const sr = p.balls>0 ? ((p.runs/p.balls)*100).toFixed(1) : 0;
      bat.innerHTML += `
        <tr>
          <td>${p.name}</td>
          <td>${p.runs}</td>
          <td>${p.balls}</td>
          <td>${p.fours}</td>
          <td>${p.sixes}</td>
          <td>${sr}</td>
        </tr>`;
    });

    bowl.innerHTML = "";
    d.bowling.forEach(b=>{
      const econ = b.overs>0 ? (b.runs/b.overs).toFixed(1) : 0;
      bowl.innerHTML += `
        <tr>
          <td>${b.name}</td>
          <td>${b.overs}</td>
          <td>${b.runs}</td>
          <td>${b.wickets}</td>
          <td>${econ}</td>
        </tr>`;
    });
  });
}

/* AUTO REFRESH */
loadAll();
setInterval(loadAll, 5000);
</script>

</body>
</html>
