<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Live Scoreboard</title>
<meta name="viewport" content="width=device-width,initial-scale=1">

<style>
body{margin:0;background:#0b1220;color:#fff;font-family:Arial}
.header{text-align:center;padding:12px;font-size:20px;font-weight:bold}
.card{padding:12px}
.score{font-size:38px;text-align:center;margin:10px 0}
.sub{text-align:center;color:#aaa;margin-bottom:10px}
.grid{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;padding:10px}
.btn{padding:16px;border-radius:10px;text-align:center;font-size:16px;font-weight:bold;cursor:pointer}
.run{background:#2ecc71}
.extra{background:#3498db}
.wkt{background:#e74c3c}
.undo{background:#f1c40f;color:#000}
.swap{background:#9b59b6}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{border-bottom:1px solid #333;padding:6px;text-align:center}
</style>
</head>
<body>

<div class="header">Live Score</div>

<div class="card">
  <div id="team">Team</div>
  <div class="score" id="score">0/0 (0.0)</div>
  <div>
    CRR: <span id="crr">0.00</span> |
    P'SHIP: <span id="pship">0 (0)</span>
  </div>

  <table>
    <thead>
      <tr>
        <th>Batter</th><th>R</th><th>B</th><th>4</th><th>6</th><th>SR</th>
      </tr>
    </thead>
    <tbody id="batBody"></tbody>
  </table>

  <table>
    <thead>
      <tr>
        <th>Bowler</th><th>O</th><th>M</th><th>R</th><th>W</th><th>ECO</th>
      </tr>
    </thead>
    <tbody id="bowlBody"></tbody>
  </table>
</div>

<div class="grid">
  <div class="btn run" onclick="sendRun(0)">0</div>
  <div class="btn run" onclick="sendRun(1)">1</div>
  <div class="btn run" onclick="sendRun(2)">2</div>
  <div class="btn run" onclick="sendRun(3)">3</div>
  <div class="btn run" onclick="sendRun(4)">4</div>
  <div class="btn run" onclick="sendRun(6)">6</div>

  <div class="btn extra" onclick="sendWide()">Wide</div>
  <div class="btn extra" onclick="sendNoBall()">NoBall</div>
  <div class="btn extra" onclick="sendLegBye()">LegBye</div>

  <div class="btn wkt" onclick="sendWicket('Bowled')">Wicket</div>
  <div class="btn swap" onclick="manualSwap()">Swap</div>
  <div class="btn undo" onclick="undo()">Undo</div>
</div>

  <script src="config.js"></script>

<script>

const matchId = new URLSearchParams(window.location.search).get("matchId");
let innings = 1;

/* ================= LOAD INITIAL ================= */

window.onload = function(){
  loadOpening();
  loadScore();
};

function callApi(data, cb){
  const params = Object.keys(data)
    .map(k => k + "=" + encodeURIComponent(data[k]))
    .join("&");

  fetch(API + "?" + params)
    .then(r => r.json())
    .then(d=>{
      if(cb) cb(d);
    });
}

/* ================= OPENING PLAYERS ================= */

function loadOpening(){
  callApi({
    action:"getOpeningPlayers",
    matchId:matchId
  }, function(res){
    if(res.status==="OK"){
      document.getElementById("striker").innerText = res.strikerId;
      document.getElementById("nonStriker").innerText = res.nonStrikerId;
      document.getElementById("bowler").innerText = res.bowlerId;
    }
  });
}

/* ================= LOAD SCORE ================= */

function loadScore(){
  callApi({
    action:"getLiveScore",
    matchId:matchId,
    innings:innings
  }, function(res){

    if(!res.score) return;

    const s = res.score;

    document.getElementById("score").innerText =
      s.runs + "/" + s.wickets +
      " (" + s.overs + "." + s.balls + ")";

    let batHtml="";
    s.batsmen.forEach(b=>{
      batHtml += `<tr>
        <td>${b.playerId}</td>
        <td>${b.runs}</td>
        <td>${b.balls}</td>
      </tr>`;
    });
    document.getElementById("batBody").innerHTML = batHtml;

    let bowlHtml="";
    s.bowlers.forEach(b=>{
      bowlHtml += `<tr>
        <td>${b.playerId}</td>
        <td>${b.runs}</td>
        <td>${b.wickets}</td>
      </tr>`;
    });
    document.getElementById("bowlBody").innerHTML = bowlHtml;
  });
}

/* ================= SCORING ================= */

function sendRun(r){
  callApi({
    action:"addBall",
    matchId:matchId,
    innings:innings,
    runBat:r
  }, loadScore);
}

function sendWide(){
  callApi({
    action:"addBall",
    matchId:matchId,
    innings:innings,
    isWide:true,
    extraRuns:1
  }, loadScore);
}

function sendNoBall(){
  callApi({
    action:"addBall",
    matchId:matchId,
    innings:innings,
    isNoBall:true,
    extraRuns:1
  }, loadScore);
}

function sendLegBye(){
  callApi({
    action:"addBall",
    matchId:matchId,
    innings:innings,
    isLegBye:true,
    extraRuns:1
  }, loadScore);
}

function sendWicket(type){
  callApi({
    action:"addBall",
    matchId:matchId,
    innings:innings,
    wicket:true,
    wicketType:type
  }, loadScore);
}

function undo(){
  callApi({
    action:"undoLastBall",
    matchId:matchId,
    innings:innings
  }, loadScore);
}

function manualSwap(){
  let s = document.getElementById("striker").innerText;
  let ns = document.getElementById("nonStriker").innerText;
  document.getElementById("striker").innerText = ns;
  document.getElementById("nonStriker").innerText = s;
}

</script>

</body>
</html>
