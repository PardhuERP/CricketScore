<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Live Score</title>
<meta name="viewport" content="width=device-width,initial-scale=1">

<style>
body{
  margin:0;
  font-family:Arial,sans-serif;
  background:#02112b;
  color:#fff;
}
.container{padding:16px}
.title{text-align:center;font-size:34px;font-weight:bold}
.team{font-size:28px;margin-top:10px}
.score{
  text-align:center;
  font-size:64px;
  margin:10px 0;
}
.info{font-size:22px;margin-bottom:10px}
table{
  width:100%;
  border-collapse:collapse;
  margin-top:8px;
}
th,td{
  padding:10px;
  text-align:center;
  font-size:22px;
  border-bottom:1px solid rgba(255,255,255,.2);
}

.button-grid{
  margin-top:16px;
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:10px;
}

.btn{
  height:75px;
  border:none;
  border-radius:12px;
  font-size:30px;
  font-weight:bold;
  color:#fff;
}
.run{background:#2ecc71;}
.extra{background:#3498db;}
.wicket{background:#e74c3c;}
.undo{background:#f1c40f;color:#000;}

</style>
</head>

<body>

<div class="container">

<div class="title">Live Score</div>

<div class="team" id="teamName">Team</div>

<div class="score" id="score">0/0 (0.0)</div>

<div class="info" id="info">
CRR: 0.00 | P'SHIP: 0 (0)
</div>

<!-- BATSMAN TABLE -->
<table>
<tr>
<th>Batter</th><th>R</th><th>B</th><th>4</th><th>6</th><th>SR</th>
</tr>
<tr>
<td id="bat1">*</td><td id="bat1r">0</td><td id="bat1b">0</td>
<td>0</td><td>0</td><td id="bat1sr">0.00</td>
</tr>
<tr>
<td id="bat2"></td><td id="bat2r">0</td><td id="bat2b">0</td>
<td>0</td><td>0</td><td id="bat2sr">0.00</td>
</tr>
</table>

<!-- BOWLER TABLE -->
<table>
<tr>
<th>Bowler</th><th>O</th><th>M</th><th>R</th><th>W</th><th>ECO</th>
</tr>
<tr>
<td id="bowler">*</td>
<td id="bo">0.0</td>
<td>0</td>
<td id="br">0</td>
<td id="bw">0</td>
<td id="be">0.00</td>
</tr>
</table>

<!-- BUTTONS -->
<div class="button-grid">

<button class="btn run" onclick="send(0)">0</button>
<button class="btn run" onclick="send(1)">1</button>
<button class="btn run" onclick="send(2)">2</button>
<button class="btn run" onclick="send(3)">3</button>

<button class="btn run" onclick="send(4)">4</button>
<button class="btn run" onclick="send(5)">5</button>
<button class="btn run" onclick="send(6)">6</button>
<button class="btn extra" onclick="extra('wide')">Wide</button>

<button class="btn extra" onclick="extra('noball')">No Ball</button>
<button class="btn extra" onclick="extra('legbye')">Leg Bye</button>
<button class="btn wicket" onclick="wicket()">Wicket</button>
<button class="btn wicket" onclick="runout()">Run Out</button>

<button class="btn undo" onclick="undo()">Undo</button>

</div>

</div>

<script>

/* ===== API ===== */
const API =
"https://script.google.com/macros/s/AKfycbyxqGY4gx6SPBqwqJAi4q3_RP1hzYie1DO-AeFJ_WREkPt3DPDWnoBUIFMSOs9kC2Ao/exec";

/* ===== MATCH ===== */
const matchId = new URLSearchParams(location.search).get("matchId") || "M1";

/* ===== API CALL ===== */
function call(params,cb){
  const url = API + "?" +
    Object.keys(params)
    .map(k=>k+"="+encodeURIComponent(params[k]))
    .join("&");

  fetch(url)
  .then(r=>r.json())
  .then(d=>cb&&cb(d));
}

/* ===== LOAD SCORE ===== */
function loadScore(){

  call(
    {action:"getLiveScore",matchId:matchId,innings:1},
    r=>{

      if(!r) return;

      document.getElementById("score").innerText =
        `${r.runs||0}/${r.wickets||0} (${r.overs||0}.${r.balls||0})`;

      if(r.batsmen && r.batsmen.length){
        let b1=r.batsmen[0]||{};
        let b2=r.batsmen[1]||{};

        bat1.innerText="*"+(b1.playerId||"");
        bat1r.innerText=b1.runs||0;
        bat1b.innerText=b1.balls||0;
        bat1sr.innerText=((b1.runs||0)/(b1.balls||1)*100).toFixed(2);

        bat2.innerText=b2.playerId||"";
        bat2r.innerText=b2.runs||0;
        bat2b.innerText=b2.balls||0;
        bat2sr.innerText=((b2.runs||0)/(b2.balls||1)*100).toFixed(2);
      }

      if(r.bowlers && r.bowlers.length){
        let b=r.bowlers[0];
        bowler.innerText="*"+(b.playerId||"");
        br.innerText=b.runs||0;
        bw.innerText=b.wickets||0;
      }

    }
  );
}

/* ===== SCORE ACTIONS ===== */

function send(run){
  call({
    action:"addBall",
    matchId:matchId,
    innings:1,
    runBat:run,
    isWide:false,
    isNoBall:false,
    isBye:false,
    isLegBye:false,
    extraRuns:0,
    wicket:false
  },loadScore);
}

function extra(type){
  call({
    action:"addBall",
    matchId:matchId,
    innings:1,
    runBat:0,
    isWide:type==="wide",
    isNoBall:type==="noball",
    isBye:false,
    isLegBye:false,
    extraRuns:1,
    wicket:false
  },loadScore);
}

function wicket(){
  call({
    action:"addBall",
    matchId:matchId,
    innings:1,
    runBat:0,
    extraRuns:0,
    wicket:true,
    wicketType:"Bowled"
  },loadScore);
}

function runout(){
  call({
    action:"addBall",
    matchId:matchId,
    innings:1,
    runBat:0,
    extraRuns:0,
    wicket:true,
    wicketType:"Run out"
  },loadScore);
}

function undo(){
  call({action:"undoLastBall",matchId:matchId,innings:1},loadScore);
}

/* ===== AUTO REFRESH ===== */
setInterval(loadScore,3000);

/* ===== INIT ===== */
loadScore();

</script>

</body>
</html>
