<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Live Score</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{margin:0;background:#00122b;color:#fff;font-family:Arial}
.container{padding:14px}
h1{text-align:center;margin:10px 0}
.score{font-size:50px;text-align:center;font-weight:bold}
.sub{text-align:center;margin:8px 0}
.table{width:100%;margin-top:10px;border-collapse:collapse}
.table td,.table th{padding:8px;border-bottom:1px solid #333;text-align:center}
.grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-top:15px}
.btn{padding:18px;font-size:24px;border:none;border-radius:12px;color:#fff}
.run{background:#2ecc71}
.extra{background:#3498db}
.wicket{background:#e74c3c}
.undo{background:#f1c40f;color:#000}
.last6{
  margin-top:10px;
  text-align:center;
  font-size:18px;
  font-weight:bold;
}
</style>
</head>

<body>

<div class="container">

<h1>Live Score</h1>

<div id="teamName"></div>
<div class="score" id="score">0/0 (0.0)</div>
<div class="sub" id="crr">CRR: 0</div>

<div class="last6" id="last6">Last 6: -</div>

<table class="table">
<tr><th>Batter</th><th>R</th><th>B</th></tr>
<tr><td id="bat1">-</td><td id="b1r">0</td><td id="b1b">0</td></tr>
<tr><td id="bat2">-</td><td id="b2r">0</td><td id="b2b">0</td></tr>
</table>

<table class="table">
<tr><th>Bowler</th><th>O</th><th>R</th><th>W</th></tr>
<tr><td id="bowler">-</td><td id="bo">0</td><td id="br">0</td><td id="bw">0</td></tr>
</table>

<div class="grid">
<button class="btn run" onclick="sendBall(0)">0</button>
<button class="btn run" onclick="sendBall(1)">1</button>
<button class="btn run" onclick="sendBall(2)">2</button>
<button class="btn run" onclick="sendBall(3)">3</button>

<button class="btn run" onclick="sendBall(4)">4</button>
<button class="btn run" onclick="sendBall(5)">5</button>
<button class="btn run" onclick="sendBall(6)">6</button>
<button class="btn extra" onclick="sendExtra('wide')">Wide</button>

<button class="btn extra" onclick="sendExtra('noball')">No Ball</button>
<button class="btn extra" onclick="sendExtra('legbye')">Leg Bye</button>
<button class="btn wicket" onclick="sendWicket()">Wicket</button>
<button class="btn wicket" onclick="sendRunOut()">Run Out</button>

<button class="btn undo" onclick="undoBall()">Undo</button>
</div>

</div>

<script src="config.js"></script>

<script>

const matchId = new URLSearchParams(location.search).get("matchId");
let innings = 1;

function callApi(params, cb){
  fetch(API + "?" + params)
  .then(r=>r.json())
  .then(cb);
}

/* ===== LOAD LIVE SCORE ===== */
function loadScore(){

  callApi("action=getLiveScore&matchId="+matchId+"&innings="+innings, r=>{

    if(!r || !r.batsmen) return;

    document.getElementById("score").innerText =
      `${r.runs}/${r.wickets} (${r.overs}.${r.balls})`;

    document.getElementById("crr").innerText =
      "CRR: " + ((r.runs/((r.overs*6+r.balls)||1))*6).toFixed(2);

    /* BATSMAN */
    const b1 = r.batsmen[0]||{};
    const b2 = r.batsmen[1]||{};

    bat1.innerText=b1.playerId||"-";
    b1r.innerText=b1.runs||0;
    b1b.innerText=b1.balls||0;

    bat2.innerText=b2.playerId||"-";
    b2r.innerText=b2.runs||0;
    b2b.innerText=b2.balls||0;

    /* BOWLER */
    const bwl = r.bowlers[0]||{};
    bowler.innerText=bwl.playerId||"-";
    br.innerText=bwl.runs||0;
    bw.innerText=bwl.wickets||0;
    bo.innerText=(bwl.balls||0)/6;

    /* LAST 6 BALLS */
    if(r.last6){
      last6.innerText = "Last 6: " + r.last6.join(" ");
    }else{
      last6.innerText = "Last 6: -";
    }

  });
}

/* ===== BALL ACTIONS ===== */

function sendBall(run){
  callApi(
    `action=addBall&matchId=${matchId}&innings=${innings}&runBat=${run}`,
    ()=>loadScore()
  );
}

function sendExtra(type){
  callApi(
    `action=addBall&matchId=${matchId}&innings=${innings}&${type}=true`,
    ()=>loadScore()
  );
}

function sendWicket(){
  callApi(
    `action=addBall&matchId=${matchId}&innings=${innings}&wicket=true`,
    ()=>loadScore()
  );
}

function sendRunOut(){
  callApi(
    `action=addBall&matchId=${matchId}&innings=${innings}&wicket=true&wicketType=Run out`,
    ()=>loadScore()
  );
}

function undoBall(){
  callApi(
    `action=undoLastBall&matchId=${matchId}&innings=${innings}`,
    ()=>loadScore()
  );
}

/* ===== AUTO REFRESH ===== */
setInterval(loadScore,3000);
loadScore();

</script>

</body>
</html>
