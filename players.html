<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Players Management</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  margin:0;
  font-family: Arial, sans-serif;
  background:#f2f4f8;
}
.header{
  background:#0a7cff;
  color:#fff;
  padding:14px;
  text-align:center;
  font-size:18px;
  font-weight:bold;
}
.container{
  padding:16px;
}
.section{
  background:#fff;
  border-radius:14px;
  padding:16px;
  margin-bottom:16px;
  box-shadow:0 4px 10px rgba(0,0,0,0.08);
}
input, select, button{
  width:100%;
  padding:12px;
  margin-top:10px;
  border-radius:8px;
  border:1px solid #ccc;
  font-size:15px;
}
button{
  background:#0a7cff;
  color:#fff;
  border:none;
  cursor:pointer;
}
.player{
  padding:8px;
  border-bottom:1px solid #eee;
}
.player:last-child{border-bottom:none;}
.note{
  font-size:13px;
  color:#666;
  margin-top:8px;
}
</style>
</head>

<body>

<div class="header">üèè Players Management</div>

<div class="container">

  <!-- ADD PLAYER -->
  <div class="section">
    <h3>‚ûï Add Player</h3>

    <select id="teamSelect"></select>

    <input type="text" id="playerName" placeholder="Player Name">

    <select id="role">
      <option value="Batsman">Batsman</option>
      <option value="Bowler">Bowler</option>
      <option value="All-Rounder">All-Rounder</option>
      <option value="Wicket Keeper">Wicket Keeper</option>
    </select>

    <button onclick="addPlayer()">Add Player</button>
    <div class="note" id="msg"></div>
  </div>

  <!-- PLAYERS LIST -->
  <div class="section">
    <h3>üìã Players List</h3>
    <div id="playersList">Loading teams‚Ä¶</div>
  </div>

</div>

<script>
/* üîí FINAL & FOREVER API URL */
const API_URL =
  "https://script.google.com/macros/s/AKfycbzdz3UnRjf-nDbzd9WCdKpQG32jXc1ehGKeXy9q_Czm8ASwHSszmvWlNQa8OSL-6VE/exec";

window.onload = loadTeams;

/* Load teams in dropdown */
function loadTeams(){
  fetch(API_URL + "?action=getTeams")
    .then(res => res.json())
    .then(data => {
      const select = document.getElementById("teamSelect");
      select.innerHTML = "";

      if(!data || data.length === 0){
        document.getElementById("playersList").innerText =
          "‚ùå No teams available. Create team first.";
        return;
      }

      data.forEach(team => {
        const opt = document.createElement("option");
        opt.value = team;
        opt.innerText = team;
        select.appendChild(opt);
      });

      loadPlayers();
    })
    .catch(()=>{
      document.getElementById("playersList").innerText =
        "‚ùå Error loading teams";
    });
}

/* Reload players when team changes */
document.getElementById("teamSelect").addEventListener("change", loadPlayers);

function loadPlayers(){
  const team = document.getElementById("teamSelect").value;
  const list = document.getElementById("playersList");

  list.innerText = "Loading players‚Ä¶";

  fetch(API_URL + "?action=getPlayers&team=" + encodeURIComponent(team))
    .then(res => res.json())
    .then(data => {
      list.innerHTML = "";

      if(!data || data.length === 0){
        list.innerText = "No players added";
        return;
      }

      data.forEach(p => {
        const div = document.createElement("div");
        div.className = "player";
        div.innerText = "üèè " + p.name + " (" + p.role + ")";
        list.appendChild(div);
      });
    })
    .catch(()=>{
      list.innerText = "‚ùå Error loading players";
    });
}

/* Add player */
function addPlayer(){
  const team = document.getElementById("teamSelect").value;
  const name = document.getElementById("playerName").value.trim();
  const role = document.getElementById("role").value;
  const msg = document.getElementById("msg");

  msg.innerText = "";

  if(name === ""){
    msg.innerText = "‚ö†Ô∏è Enter player name";
    msg.style.color = "orange";
    return;
  }

  fetch(API_URL,{
    method:"POST",
    body:JSON.stringify({
      action:"addPlayer",
      team:team,
      name:name,
      role:role
    })
  })
  .then(()=>{
    msg.innerText = "‚úÖ Player added";
    msg.style.color = "green";
    document.getElementById("playerName").value = "";
    loadPlayers();
  })
  .catch(()=>{
    msg.innerText = "‚ùå Server error";
    msg.style.color = "red";
  });
}
</script>

</body>
</html>
