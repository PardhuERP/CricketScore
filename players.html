<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Players Management</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  margin:0;
  font-family:Arial;
  background:#f2f4f8;
}
.header{
  background:#0a7cff;
  color:#fff;
  padding:14px;
  text-align:center;
  font-size:18px;
  font-weight:bold;
}
.container{ padding:16px; }

.card{
  background:#fff;
  border-radius:14px;
  padding:16px;
  margin-bottom:14px;
  box-shadow:0 4px 10px rgba(0,0,0,0.08);
}

input, select, button{
  width:100%;
  padding:12px;
  margin-top:10px;
  border-radius:8px;
  border:1px solid #ccc;
  font-size:15px;
}

button{
  background:#0a7cff;
  color:#fff;
  border:none;
  cursor:pointer;
}

.player{
  padding:8px 0;
  border-bottom:1px solid #eee;
  font-size:14px;
}
.player:last-child{ border-bottom:none; }

.badge{
  background:#eee;
  padding:2px 6px;
  border-radius:6px;
  font-size:11px;
  margin-left:6px;
}
.captain{ background:#ffc107; }
.keeper{ background:#4caf50; color:#fff; }

.back{
  margin-bottom:10px;
  background:#555;
}
</style>
</head>

<body>

<div class="header">ðŸ‘¥ Players Management</div>

<div class="container">

  <button class="back" onclick="location='dashboard.html'">â¬… Back to Dashboard</button>

  <!-- ADD PLAYER -->
  <div class="card">
    <h3>âž• Add Player</h3>

    <select id="teamSelect"></select>

    <input id="playerName" placeholder="Player Name">

    <select id="role">
      <option value="">Select Role</option>
      <option value="BAT">Batsman</option>
      <option value="BOWL">Bowler</option>
      <option value="AR">All Rounder</option>
      <option value="WK">Wicket Keeper</option>
    </select>

    <label>
      <input type="checkbox" id="isCaptain"> Captain
    </label><br>

    <label>
      <input type="checkbox" id="isKeeper"> Wicket Keeper
    </label>

    <button onclick="addPlayer()">Add Player</button>

    <div id="msg"></div>
  </div>

  <!-- PLAYERS LIST -->
  <div class="card">
    <h3>ðŸ“‹ Players</h3>
    <select id="filterTeam" onchange="loadPlayers()"></select>
    <div id="playersList">Loading...</div>
  </div>

</div>

<script>
const API_URL =
"https://script.google.com/macros/s/AKfycbzdz3UnRjf-nDbzd9WCdKpQG32jXc1ehGKeXy9q_Czm8ASwHSszmvWlNQa8OSL-6VE/exec";

/* ========== LOAD TEAMS ========== */
function loadTeams(){
  const cb = "cbTeams_" + Date.now();
  window[cb] = function(data){
    const teamSel = document.getElementById("teamSelect");
    const filterSel = document.getElementById("filterTeam");
    teamSel.innerHTML = "";
    filterSel.innerHTML = "";

    data.forEach(t=>{
      teamSel.innerHTML += `<option value="${t}">${t}</option>`;
      filterSel.innerHTML += `<option value="${t}">${t}</option>`;
    });

    loadPlayers();
    delete window[cb];
  };

  const s = document.createElement("script");
  s.src = API_URL + "?action=getTeams&callback=" + cb;
  document.body.appendChild(s);
}

/* ========== ADD PLAYER ========== */
function addPlayer(){
  const team = teamSelect.value;
  const name = playerName.value.trim();
  const role = document.getElementById("role").value;
  const captain = isCaptain.checked ? "YES" : "";
  const keeper = isKeeper.checked ? "YES" : "";

  const msg = document.getElementById("msg");

  if(!team || !name || !role){
    msg.innerText = "âš ï¸ Fill all required fields";
    msg.style.color = "orange";
    return;
  }

  const cb = "cbAdd_" + Date.now();
  window[cb] = function(res){
    if(res.status === "ok"){
      msg.innerText = "âœ… Player added";
      msg.style.color = "green";
      playerName.value = "";
      isCaptain.checked = false;
      isKeeper.checked = false;
      loadPlayers();
    }else{
      msg.innerText = "âŒ Error";
      msg.style.color = "red";
    }
    delete window[cb];
  };

  const s = document.createElement("script");
  s.src =
    API_URL +
    "?action=addPlayer" +
    "&team=" + encodeURIComponent(team) +
    "&name=" + encodeURIComponent(name) +
    "&role=" + role +
    "&isCaptain=" + captain +
    "&isKeeper=" + keeper +
    "&callback=" + cb;

  document.body.appendChild(s);
}

/* ========== LOAD PLAYERS ========== */
function loadPlayers(){
  const team = filterTeam.value;
  const list = document.getElementById("playersList");
  list.innerHTML = "Loading...";

  const cb = "cbPlayers_" + Date.now();
  window[cb] = function(data){
    list.innerHTML = "";
    if(!data || data.length === 0){
      list.innerText = "No players";
    }else{
      data.forEach(p=>{
        let html = p.name + " (" + p.role + ")";
        if(p.isCaptain==="YES") html += `<span class="badge captain">C</span>`;
        if(p.isKeeper==="YES") html += `<span class="badge keeper">WK</span>`;
        list.innerHTML += `<div class="player">${html}</div>`;
      });
    }
    delete window[cb];
  };

  const s = document.createElement("script");
  s.src =
    API_URL +
    "?action=getPlayers" +
    "&team=" + encodeURIComponent(team) +
    "&callback=" + cb;

  document.body.appendChild(s);
}

/* INIT */
window.onload = loadTeams;
</script>

</body>
</html>
